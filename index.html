<!DOCTYPE html>
<html lang="ku" dir="rtl">
<head>
 <meta charset="UTF-8">
 <meta name="viewport" content="width=device-width, initial-scale=1.0">
 <title id="main-title">یاری فێڵباز (Imposter)</title>
 <script src="https://cdn.tailwindcss.com"></script>
 <script>
     tailwind.config = {
         theme: {
             extend: {
                 colors: {
                     'primary': '#facc15', // Tailwind Amber 500
                     'secondary': '#6366f1', // Tailwind Indigo 500
                     'dark-bg': '#1e293b', // Tailwind Slate 800
                     'dark-card': '#334155', // Tailwind Slate 700
                     'input-bg': '#475569', // Tailwind Slate 600
                 },
                 fontFamily: {
                     'kurdish': ['Scheherazade New', 'sans-serif'],
                     'english': ['Roboto', 'sans-serif'],
                 }
             }
         }
     }
 </script>
 <style>
     @import url('https://fonts.googleapis.com/css2?family=Scheherazade+New:wght@400;700&display=swap');
     @import url('https://fonts.googleapis.com/css2?family=Roboto:wght+400;700&display=swap');

     body {
         background-color: #0f172a; /* Tailwind Slate 900 */
         background-image: radial-gradient(rgba(255,255,255,0.05) 1px, transparent 1px), radial-gradient(rgba(255,255,255,0.05) 1px, transparent 1px);
         background-size: 40px 40px;
         background-position: 0 0, 20px 20px;
         display: flex;
         justify-content: center;
         align-items: center;
         min-height: 100vh;
         padding: 20px;
         font-family: 'kurdish', 'english';
     }

     .card {
         background-color: var(--dark-card);
         border-radius: 1.5rem;
         padding: 2.5rem 1.5rem;
         box-shadow: 0 10px 15px rgba(0, 0, 0, 0.5);
         max-width: 420px;
         width: 100%;
         margin-top: 20px;
         margin-bottom: 20px;
     }

     .title-bar {
         border-bottom: 2px solid rgba(255, 255, 255, 0.1);
         padding-bottom: 0.75rem;
         margin-bottom: 1.5rem;
     }

     /* Styling for all input types to match the dark theme */
     input[type="number"], input[type="text"], .input-text-area {
         background-color: var(--input-bg);
         color: #f8fafc; /* Tailwind Slate 50 */
         border: 1px solid #475569;
         border-radius: 0.5rem;
         padding: 0.5rem 0.75rem;
         width: 100%;
         margin-bottom: 0.75rem;
         text-align: right; /* Default for RTL */
     }

     .english-mode input[type="number"], .english-mode input[type="text"], .english-mode .input-text-area {
          text-align: left; /* Change for LTR/English */
     }

     /* Checkbox custom style */
     .checkbox-container {
         display: flex;
         align-items: center;
         margin-top: 10px;
         margin-bottom: 15px;
     }

     .checkbox-container input[type="checkbox"] {
         /* Hide the default checkbox */
         opacity: 0;
         width: 0;
         height: 0;
     }

     .checkbox-checkmark {
         height: 20px;
         width: 20px;
         background-color: var(--input-bg);
         border-radius: 4px;
         border: 1px solid var(--primary);
         display: inline-block;
         position: relative;
         cursor: pointer;
     }

     .checkbox-container input:checked ~ .checkbox-checkmark {
         background-color: var(--primary);
     }

     .checkbox-checkmark:after {
         content: "";
         position: absolute;
         display: none;
         left: 7px;
         top: 3px;
         width: 5px;
         height: 10px;
         border: solid #1e293b;
         border-width: 0 3px 3px 0;
         transform: rotate(45deg);
     }

     .checkbox-container input:checked ~ .checkbox-checkmark:after {
         display: block;
     }

     /* Button Styling */
     .primary-btn {
         background: linear-gradient(145deg, #facc15, #eab308); /* Amber gradient */
         color: #1e293b;
         font-weight: 700;
         padding: 0.75rem 1.5rem;
         border-radius: 0.75rem;
         box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3), 0 1px 3px rgba(0, 0, 0, 0.15);
         transition: all 0.2s;
         width: 100%;
     }

     .primary-btn:hover {
         opacity: 0.9;
         transform: translateY(-1px);
         box-shadow: 0 6px 8px rgba(0, 0, 0, 0.4), 0 2px 4px rgba(0, 0, 0, 0.2);
     }

     .player-card {
         background-color: #475569;
         border: 1px solid #64748b;
         padding: 20px;
         border-radius: 1rem;
         margin-top: 1.5rem;
         text-align: center;
         box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
         transition: all 0.3s;
     }
   
     .player-card:hover {
         transform: scale(1.02);
     }

     /* New color definitions for words */
     .word-civilian {
         color: #34d399; /* Tailwind Emerald 400 - Green */
     }
     .word-imposter {
         color: #f87171; /* Tailwind Red 400 - Red */
     }

     .role-text {
         font-size: 1.5rem;
         font-weight: 700;
         color: var(--primary);
         margin-bottom: 10px;
     }

     .word-text {
         font-size: 1.25rem;
         color: #f8fafc;
     }
   
     /* Language Button */
     .lang-btn {
         background-color: var(--secondary);
         color: #f8fafc;
         padding: 0.5rem 1rem;
         border-radius: 0.5rem;
         font-size: 0.875rem;
         transition: background-color 0.2s;
         margin-bottom: 1.5rem;
     }
     .lang-btn:hover {
         background-color: #4f46e5;
     }

     .footer-text {
         margin-top: 2rem;
         text-align: center;
         font-size: 0.8rem;
         color: #94a3b8;
     }
   
     .footer-text a {
         color: var(--primary);
         text-decoration: none;
         margin-right: 5px;
         margin-left: 5px;
     }
     .footer-text a:hover {
         text-decoration: underline;
     }

     /* Custom Modal Styles */
     #custom-modal {
         position: fixed;
         top: 0;
         left: 0;
         width: 100%;
         height: 100%;
         background-color: rgba(0, 0, 0, 0.7);
         display: flex;
         justify-content: center;
         align-items: center;
         z-index: 1000;
         opacity: 0;
         visibility: hidden;
         transition: opacity 0.3s, visibility 0.3s;
         /* ADDED: Allow scrolling when the modal is up */
         overflow-y: auto;
     }
     #custom-modal.show {
         opacity: 1;
         visibility: visible;
     }
     .modal-content {
         background-color: var(--dark-card);
         /* Adjusted margin for better centering on smaller screens and to allow scroll */
         margin: 5% auto; 
         padding: 2rem;
         border-radius: 1rem;
         max-width: 350px;
         width: 90%;
         color: #f8fafc;
         text-align: center;
         box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
         transform: translateY(-50px);
         transition: transform 0.3s;
         /* ADDED: Max height and overflow for the content itself */
         max-height: 90vh;
         overflow-y: auto;
         position: relative; /* For close button positioning */
     }
     #custom-modal.show .modal-content {
         transform: translateY(0);
     }
     .modal-title {
         font-size: 1.5rem;
         font-weight: 700;
         color: #facc15; /* Use primary color for titles */
         margin-bottom: 0.75rem;
     }
     /* Specific title color for validation/imposter reveal */
     .imposter-popup .modal-title {
        color: #f87171; /* Red color for Imposter reveal */
        font-size: 2rem;
     }
     /* Specific message color for imposter reveal name */
     .imposter-popup .modal-message {
        font-size: 1.5rem;
        font-weight: bold;
        color: #facc15; /* Primary color for the name */
     }
     /* Normal message text */
     .modal-message {
         margin-bottom: 1.5rem;
         font-size: 1rem;
         text-align: right; /* Default for RTL */
     }
     .ltr .modal-message {
         text-align: left; /* Change for LTR/English */
     }
     .modal-message strong {
         color: #facc15;
     }
     
     /* ADDED: Close button style for modal */
     .modal-close-btn {
        position: absolute;
        top: 10px;
        /* Positioned for RTL and LTR support */
        right: 10px; 
        font-size: 1.5rem;
        background: none;
        border: none;
        color: #f8fafc;
        cursor: pointer;
        line-height: 1;
        padding: 5px;
     }
     .rtl .modal-close-btn {
        right: 10px;
        left: auto;
     }
     .ltr .modal-close-btn {
        left: 10px;
        right: auto;
     }

     /* --- SHARE BUTTON STYLES --- */
     .share-button {
         position: fixed;
         bottom: 20px;
         left: 20px;
         background-color: var(--secondary);
         color: white;
         border: none;
         border-radius: 50%;
         width: 50px;
         height: 50px;
         display: flex;
         align-items: center;
         justify-content: center;
         cursor: pointer;
         box-shadow: 0 4px 10px rgba(0, 0, 0, 0.4);
         z-index: 1000;
         transition: background-color 0.2s, transform 0.2s;
     }
     .share-button:hover {
         background-color: #4f46e5;
         transform: scale(1.05);
     }
     /* RTL adjustments for share button */
     .rtl .share-button {
         left: auto;
         right: 20px;
     }
     /* LTR adjustment for share button */
     .ltr .share-button {
         right: auto;
         left: 20px;
     }

     /* --- NEW HELP BUTTON STYLES --- */
     .help-button {
         position: fixed;
         bottom: 20px;
         background-color: #34d399; /* Tailwind Emerald 400 */
         color: #1e293b;
         border: none;
         border-radius: 50%;
         width: 50px;
         height: 50px;
         font-size: 1.5rem;
         font-weight: bold;
         display: flex;
         align-items: center;
         justify-content: center;
         cursor: pointer;
         box-shadow: 0 4px 10px rgba(0, 0, 0, 0.4);
         z-index: 1000;
         transition: background-color 0.2s, transform 0.2s;
     }
     .help-button:hover {
         background-color: #10b981; /* Tailwind Emerald 500 */
         transform: scale(1.05);
     }
     /* Positioning for help button relative to the share button */
     .rtl .help-button {
         right: 90px; /* 20px + 50px width + 20px spacing */
         left: auto;
     }
     .ltr .help-button {
         left: 90px; /* 20px + 50px width + 20px spacing */
         right: auto;
     }
 </style>
</head>
<body class="rtl" style="--dark-card: #334155; --input-bg: #475569; --primary: #facc15; --secondary: #6366f1;">

 <div id="game-container" class="card">
     </div>

 <div id="custom-modal">
     <div class="modal-content" id="modal-inner">
         </div>
 </div>

 <button id="shareButton" class="share-button hidden" onclick="shareGameLink()">
     <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-share-2"><circle cx="18" cy="5" r="3"></circle><circle cx="6" cy="12" r="3"></circle><circle cx="18" cy="19" r="3"></circle><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line></svg>
 </button>

 <button id="helpButton" class="help-button" onclick="showHelpModal()">
    ?
 </button>


 <script>
     // Global state for modal
     const modal = document.getElementById('custom-modal');
     const modalInner = document.getElementById('modal-inner');
     const shareButton = document.getElementById('shareButton');
     const helpButton = document.getElementById('helpButton'); // Get the new help button
   
     const showModal = (titleKey, messageKey, isImposterReveal = false) => {
         // Reset classes
         modalInner.classList.remove('imposter-popup');
         if (isImposterReveal) {
             modalInner.classList.add('imposter-popup');
         }

         modalInner.innerHTML = `
             <button class="modal-close-btn" onclick="hideModal()">
                &times;
             </button>
             <h3 class="modal-title">${T(titleKey)}</h3>
             <p class="modal-message">${T(messageKey)}</p>
             <button class="primary-btn" onclick="hideModal()">
                 ${T('close')}
             </button>
         `;
         modal.classList.add('show');
     };

     const hideModal = () => {
         modal.classList.remove('show');
     };
     
     // --- NEW HELP MODAL LOGIC ---
     const showHelpModal = () => {
         modalInner.classList.remove('imposter-popup');
         modalInner.innerHTML = `
             <button class="modal-close-btn" onclick="hideModal()">
                &times;
             </button>
             <h3 class="modal-title">${T('howToPlayTitle')}</h3>
             <p class="modal-message" style="text-align: ${lang === 'ku' ? 'right' : 'left'};">
                 ${T('howToPlayBody')}
             </p>
             <button class="primary-btn" onclick="hideModal()">
                 ${T('close')}
             </button>
         `;
         modal.classList.add('show');
     };
     // --- END NEW HELP MODAL LOGIC ---

     // --- Data: Word Lists (EXPANDED) ---
     
     // ADDED: Many more words, especially physical ones (places, animals, plants)
     const WORDS_KU = [
        // Jobs/People
        "پزیشک", "مامۆستا", "ئەندازیار", "فەرمانبەر", "شۆفێر", "گۆرانیبێژ", "نووسەر", "وەرگێڕ",
        "کاسبکار", "وێنەکێش", "باخچەوان", "نانەوا", "گەشتیار", "وەرزشکار", "فرۆشیار", "پۆلیس",
        "سەرباز", "ئاگرکوژێنەر", "بازرگان", "ڕۆژنامەنووس", "جووتیار", "پاسەوان", "قەشە", "ڕاوچی", "شوان", 

        // Animals (ئاژەڵ)
        "سەگ", "پشیلە", "ئاژەڵ", "ورچ", "گورگ", "ئاسک", "ڕێوی", "شێر", "نەهەنگ", "ئەسپ", "شەمشەمەکوێرە",
        "سمۆرە", "فیل", "مەیموون", "چیمپانزی", "هەڵۆ", "کوندەپەپوو", "قەلەڕەش", "تووتی", "مریشک", "قاز", "مەل",
        "مار", "مارمێلکە", "قەل", "کیسەڵ", "تمساح", "بۆق", "ماسی", "قرش", "ئەختەبوت", "سێل", "دۆلفین", 
        "جاڵجاڵۆکە", "مێرولە", "هەنگ", "پەپوولە", "کوولە", "دووپشک", "مشک", "شیرینەم", "پڵنگ", "کەرکەدەن",

        // Plants and Nature (ڕووەک و سروشت)
        "دار", "گوڵ", "سەوزایی", "میوە", "سەوزە", "داربڵاڵووک", "سنەوبەر", "بی", "لەپ", "ڕەگ", "تەنە", 
        "لق", "گەڵا", "تەماتە", "خەیار", "پیاز", "سیر", "قارچک", "مۆس", "فەڕن", "توو", "گژوگیا", "گەنم", "گەنمەشامی",
        "گیراوە", "هاڵاز", "پەتاتە", "چای", "قاوە", "شیر", "هەنگوین", "زەیتوون", "گەزۆ", "سروشت", 

        // Places and Structures (شوێن و بینا)
        "چیا", "دەشت", "دەریا", "گوند", "شار", "ماڵ", "قوتابخانە", "زانکۆ", "کارگە", "مۆزەخانە", "شانۆ",
        "سینەما", "مزگەوت", "کڵێسا", "پەرستگا", "قەڵا", "شەقام", "بیابان", "زۆنگاو", "دارستان", "کانی",
        "ئۆتۆمبێل", "فڕۆکە", "شەمەندەفەر", "پاسکیل", "کۆمەڵگا", "خێزان", "هاوڕێ", "دراوسێ", "کۆمەڵە",
        "کەمپی پەنابەران", "ناوچە", "شارۆچکە", "پایتەخت", "گەراج", "بازاڕ", "دوکان", "قاوەخانە", "کتێبفرۆش",
        "قەراغ دەریا", "گەروو", "تاڤگە", "دوورگە", "گڕکان", "گەنجینە", "سنوور", "بەرنامە", "ماڵپەڕ",
        
        // Objects and Concepts (شت و چەمک)
        "خۆراک", "ئاو", "هەور", "باران", "بەفر", "هەتاو", "مانگ", "ئەستێرە", "کتێب", "قەڵەم", "لاپەڕە",
        "مۆبایل", "کۆمپیوتەر", "مۆسیقا", "شێعر", "ڕۆمان", "چیرۆک", "ڕەنگ", "دەنگ", "بۆن", "تامی", "ڕووناکی",
        "تاریکی", "گاز", "پەتڕۆڵ", "کارەبا", "مەترسی", "ئاسایش", "دادگا", "یاسا", "سیاسەت", "ئابووری", 
        "فەلسەفە", "مێژوو", "جوگرافیا", "فیزیک", "کیمیا", "بیرکاری", "پەروەردە", "تەندروستی", "ژینگە",
        "مافی مرۆڤ", "ئازادی", "یەکسانی", "خەون", "ڕاستی", "خۆشەویستی", "ڕق", "ترس", "هیوا", "ئارامی", 
        "شەڕ", "ئاشتی", "شیرینی", "سوێری", "تاڵی", "تیژی", "خوێن", "مێشک", "دڵ", "گەدە", "چاو", "گوێ", "دەست", 
        "قاچ", "پێست", "موو", "جلوبەرگ", "سفرە", "ماتۆر", "تەلبەند", "فیشەک", "بۆمب", "ڕۆکێت", "ناوچە", 
        "تەختە", "قوماش", "جام", "زەلکاو", "دەمانچە", "تەقینەوە", "بەڵگەنامە", "تاوان", "کلیل", "سندوق",
        "ژمارە", "پیت", "وشە", "دروستکردن", "خاک", "گشت", "کشتوکاڵ", "کابینە", "مۆم", "ئامێر", "وڵات", "پارتی"
     ];
   
     const WORDS_EN = [
        // Jobs/People
        "Doctor", "Teacher", "Engineer", "Employee", "Driver", "Singer", "Writer", "Translator",
        "Merchant", "Painter", "Gardener", "Baker", "Tourist", "Athlete", "Seller", "Police",
        "Soldier", "Firefighter", "Trader", "Journalist", "Farmer", "Guard", "Priest", "Hunter", "Shepherd", 

        // Animals
        "Dog", "Cat", "Animal", "Bear", "Wolf", "Deer", "Fox", "Lion", "Whale", "Horse", "Bat", "Squirrel",
        "Elephant", "Monkey", "Chimpanzee", "Eagle", "Owl", "Raven", "Parrot", "Chicken", "Goose", "Bird",
        "Snake", "Lizard", "Frog", "Turtle", "Alligator", "Toad", "Fish", "Shark", "Octopus", "Seal", "Dolphin", 
        "Spider", "Ant", "Bee", "Butterfly", "Moth", "Scorpion", "Mouse", "Cheetah", "Rhinoceros",

        // Plants and Nature
        "Tree", "Flower", "Greenery", "Fruit", "Vegetable", "Oak", "Pine", "Willow", "Birch", "Palm", "Root", "Trunk", 
        "Branch", "Leaf", "Tomato", "Cucumber", "Onion", "Garlic", "Mushroom", "Moss", "Fern", "Berry", "Herb", "Grass", 
        "Wheat", "Corn", "Vine", "Algae", "Potato", "Tea", "Coffee", "Milk", "Honey", "Olive", "Nature",

        // Places and Structures
        "Mountain", "Plain", "Sea", "Village", "City", "House", "School", "University", "Factory", "Museum", "Theater", 
        "Cinema", "Mosque", "Church", "Temple", "Castle", "Street", "Desert", "Swamp", "Forest", "River", 
        "Car", "Airplane", "Train", "Bicycle", "Society", "Family", "Friend", "Neighbor", "Group",
        "Refugee Camp", "Area", "Town", "Capital City", "Garage", "Market", "Shop", "Coffee Shop", "Bookstore",
        "Coast", "Canyon", "Waterfall", "Island", "Volcano", "Treasure", "Border", "Program", "Website",
        
        // Objects and Concepts
        "Food", "Water", "Cloud", "Rain", "Snow", "Sun", "Moon", "Star", "Book", "Pen", "Page",
        "Mobile", "Computer", "Music", "Poem", "Novel", "Story", "Color", "Sound", "Smell", "Taste", "Light",
        "Darkness", "Gas", "Petrol", "Electricity", "Danger", "Safety", "Court", "Law", "Politics", "Economy", 
        "Philosophy", "History", "Geography", "Physics", "Chemistry", "Mathematics", "Education", "Health", 
        "Environment", "Human Rights", "Freedom", "Equality", "Dream", "Reality", "Love", "Hate",
        "Fear", "Hope", "Peace", "War", "Sweet", "Salty", "Bitter", "Spicy", "Blood", "Brain", "Heart", 
        "Stomach", "Eye", "Ear", "Hand", "Leg", "Skin", "Hair", "Clothing", "Tablecloth", "Motorcycle", "Fence", 
        "Bullet", "Bomb", "Rocket", "Region", "Board (Wood)", "Cloth", "Glass", "Marsh", "Pistol", "Explosion",
        "Document", "Crime", "Key", "Box", "Number", "Letter (Alphabet)", "Word", "Creation", "Soil", "Total", 
        "Agriculture", "Cabinet (Government)", "Candle", "Device", "Country", "Party"
     ];


     // --- State Variables (Unchanged) ---
     let lang = 'ku';
     let playerCount = 4;
     let imposterCount = 1;
     let showHint = false;
     let playerNames = [];
     let gameActive = false;
     let roles = [];
     let secretWord = '';
     let imposterHintWord = '';

     // --- NEW TIMER VARIABLES ---
     let timerInterval;
     let timeLeft;


     // --- Helper Functions (Updated showModal, showHelpModal) ---

     /** Fetches the correct word list based on the current language. */
     const getWordList = () => lang === 'ku' ? WORDS_KU : WORDS_EN;
   
     /** Translation function */
     const T = (key, l = lang) => {
         const translations = {
             ku: {
                 appName: "یاری فێڵباز",
                 imposter: "فێڵباز",
                 civilian: "هاوڵاتی",
                 playerCount: "ژمارەی یاریزانان (3-12):",
                 imposterCount: "ژمارەی فریودەران (1-2):",
                 hint: "ڕێنمایی بۆ فێڵباز (وشەیەکی پەیوەندیدار)",
                 start: "دەستپێکردنی یاری",
                 playerName: "ناوی یاریزان",
                 showRole: "ڕۆڵی خۆت ببینە",
                 yourRole: "ڕۆڵی تۆ:",
                 theWord: "وشەی نهێنی:",
                 madeBy: "Made By Naseh M. Zebari",
                 turn: "نۆرەی یاریزانان",
                 close: "داخستن",
                 reset: "دووبارە دەستپێکردنەوە",
                 revealWord: "وشەی نهێنی نیشان بدە (بۆ هەمووان)",
                 wordWas: "وشەی نهێنی بریتی بوو لە:",
                 selectWord: "تکایە وشەی نهێنی هەڵبژێرە!",
                 validationTitle: "هۆشداری",
                 nameRequired: "تکایە ناوی هەموو یاریزانەکان بنووسە.",
                 notEnoughPlayers: "ژمارەی یاریزانان کەمە. پێویستت بە لانی کەم 3 یاریزانە.",
                 revealImposters: "فێڵبازەکان نیشان بدە",
                 impostersWere: "فێڵبازەکان بریتی بوون لە:",
                 justImposter: "تۆ فێڵبازی!",
                 imposterHintLabel: "ڕێنمایی وشە:",
                 startDiscussion: "دەستپێکردنی گفتوگۆ",
                 discussionTime: "کاتی گفتوگۆ:",
                 timesUp: "کات کۆتایی هات!",
                 imposterWas: "فێڵبازەکە بریتی بوو لە:",
                 shareLink: "لینکی یارییەکە بنێرە بۆ هاوڕێکانت!",
                 and: "و",
                 // NEW HELP TRANSLATIONS
                 howToPlayTitle: "چۆن یاری دەکەیت: یاری فێڵباز",
                 howToPlayBody: `ئامانج ئەوەیە هەمووان قەناعەت پێبکەیت کە وشەی نهێنی دەزانیت—یاخود ئەو کەسە بدۆزیتەوە کە نایزانێت.
                    <br><br>
                    <strong>١. 🤫 ڕۆڵی خۆت بدۆزەرەوە</strong>
                    <br>
                    • مۆبایلەکە بەدەوردا دەسوڕێنرێتەوە بۆ ئەوەی هەمووان بە نهێنی سەیری شاشەکە بکەن.
                    <br>
                    • زۆربەی یاریزانەکان <strong>وشەی نهێنی</strong> دەبینن (بۆ نموونە: قەنەفە).
                    <br>
                    • یەک یاریزان <strong>"فریودەر"</strong> دەبینێت.
                    <br><br>
                    <strong>٢. 🗣️ ئاماژە بدە</strong>
                    <br>
                    • بە دەوری بازنەکەدا بگەڕێن. هەر یاریزانێک <strong>یەک وشە</strong> بۆ وەسفکردنی وشە نهێنییەکە دەدات.
                    <br>
                    • <strong>ئەگەر وشەکە دەزانیت:</strong> ئاماژەکەت دەبێت ئەوەندە دیاریکراو بێت کە بیسەلمێنێت دەیزانیت، بەڵام ئەوەندەش ناڕوون بێت کە فێڵبازەکە سەرلێشێواو بکات.
                    <br>
                    • <strong>ئەگەر تۆ فێڵبازیت:</strong> ئاماژەیەکی گشتی بدە کە لەگەڵ پۆلەکەدا بگونجێت (بۆ نموونە: کەلوپەل) و هەوڵبدە تێکەڵ ببیت!
                    <br><br>
                    <strong>٣. 🗳️ دەنگدان</strong>
                    <br>
                    • دوای ٢-٣ گەڕی ئاماژەدان، گفتوگۆ دەستپێدەکات. تۆمەت بخەرە پاڵ ئەو یاریزانەی کە ئاماژەکانی گوماناویترین یان گشتیترین بوون.
                    <br>
                    • هەمووان دەنگ دەدەن بۆ ئەوەی بزانن کێ گوماناوییە. ئەو یاریزانەی زۆرترین دەنگ بەدەست دەهێنێت ئاشکرا دەکرێت.
                    <br><br>
                    <strong>چۆن دەیبەیتەوە 🏆 :</strong>
                    <br><br>
                    • <strong>هاوڵاتییەکان:</strong>
                    <br>
                    -ئەگەر پێش کۆتایی هاتنی کات فریودەرەکە بدۆزنەوە.
                    <br><br>
                    • <strong>فێڵباز:</strong>
                    <br>
                    -ئەگەر هاوڵاتییەکان نەیاندۆزنەوە کە کێ فێڵبازە.
                    <br>
                    -ئەگەر کاتەکە کۆتایی بێت.`,
             },
             en: {
                 appName: "The Imposter Game",
                 imposter: "Imposter",
                 civilian: "Civilian",
                 playerCount: "Number of Players (3-12):",
                 imposterCount: "Number of Imposters (1-2):",
                 hint: "Imposter Hint (Related Word)",
                 start: "Start Game",
                 playerName: "Player Name",
                 showRole: "View Your Role",
                 yourRole: "Your Role:",
                 theWord: "The Secret Word:",
                 madeBy: "Made by Naseh M. Zebari",
                 turn: "Player Turn",
                 close: "Close",
                 reset: "Start New Game",
                 revealWord: "Reveal Secret Word (For All)",
                 wordWas: "The secret word was:",
                 selectWord: "Please select a secret word!",
                 validationTitle: "Warning",
                 nameRequired: "Please enter all player names.",
                 notEnoughPlayers: "Not enough players. You need at least 3 players.",
                 revealImposters: "Reveal Imposters",
                 impostersWere: "The Imposters were:",
                 justImposter: "You are the Imposter!",
                 imposterHintLabel: "Word Hint:",
                 startDiscussion: "Start Discussion",
                 discussionTime: "Discussion Time:",
                 timesUp: "Time's Up!",
                 imposterWas: "The Imposter was:",
                 shareLink: "Share the game link with your friends!",
                 and: "and",
                 // NEW HELP TRANSLATIONS
                 howToPlayTitle: "How to Play: The Imposter Game",
                 howToPlayBody: `The goal is to convince everyone you know the Secret Word—or find the person who doesn't.
                    <br><br>
                    <strong>1. 🤫 Find Your Role</strong>
                    <br>
                    • The phone is passed around for everyone to look at the screen in secret.
                    <br>
                    • Most Players will see the <strong>Secret Word</strong> (e.g., Sofa).
                    <br>
                    • One Player will see <strong>"IMPOSTOR."</strong>
                    <br><br>
                    <strong>2. 🗣️ Give Clues</strong>
                    <br>
                    • Go around the circle. Each player gives <strong>ONE WORD</strong> to describe the Secret Word.
                    <br>
                    • <strong>If you know the word:</strong> Your clue must be specific enough to prove you know it, but vague enough to confuse the Impostor.
                    <br>
                    • <strong>If you are the Impostor:</strong> Give a general clue that fits the category (e.g., Furniture) and try to blend in!
                    <br><br>
                    <strong>3. 🗳️ Vote</strong>
                    <br>
                    • After 2-3 rounds of clues, the discussion begins. Accuse the player whose clues seemed the most suspicious or generic.
                    <br>
                    • Everyone votes on who they think the Impostor is. The player with the most votes is revealed.
                    <br><br>
                    <strong>How to Win 🏆 :</strong>
                    <br><br>
                    • <strong>The Civilians:</strong>
                    <br>
                    -If they find out who is really the Imposter before the timer finishes.
                    <br><br>
                    • <strong>The Imposter:</strong>
                    <br>
                    -If the Civilians didn’t find out that he is the Imposter.
                    <br>
                    -If the timer finishes.`,
             }
         };
         return translations[l][key] || translations['ku'][key];
     };


     // --- NEW SHARE LOGIC (Unchanged) ---
     const shareGameLink = async () => {
         // The URL you want to share (The current page URL)
         const shareUrl = window.location.href; 
         
         if (navigator.share) {
             try {
                 await navigator.share({
                     title: T('appName'),
                     text: T('shareLink'),
                     url: shareUrl,
                 });
                 console.log('Content shared successfully');
             } catch (error) {
                 // User likely cancelled the share
                 console.error('Error sharing:', error);
             }
         } else {
             // Fallback: Copy link to clipboard for unsupported browsers
             await navigator.clipboard.writeText(shareUrl);
             alert(`${T('shareLink')} (Link copied to clipboard)`);
         }
     };

     // --- NEW TIMER LOGIC (Unchanged) ---

     // Function to format seconds into MM:SS
     const formatTime = (totalSeconds) => {
         const minutes = Math.floor(totalSeconds / 60);
         const seconds = totalSeconds % 60;
         return `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
     }

     // Function to handle the end of the timer
     const timerFinished = () => {
         clearInterval(timerInterval); // Stop the timer
         document.getElementById('timerDisplay').textContent = T('timesUp');
         
         // 1. Get Imposter names
         const imposterNames = roles
             .filter(r => r.role === T('imposter'))
             .map(r => r.name);
         const imposterList = imposterNames.join(' ' + T('and') + ' '); // Join names

         // 2. Show the pop-up automatically
         showModal('imposterWas', imposterList, true);

         // 3. Automatically reveal the imposter list on the page as well (cleaner UX)
         revealImposters(true); // Call existing reveal logic without button click
     }

     // Function to update the timer
     const countdown = () => {
         if (timeLeft <= 0) {
             timerFinished();
         } else {
             timeLeft--;
             document.getElementById('timerDisplay').textContent = `${T('discussionTime')} ${formatTime(timeLeft)}`;
         }
     }

     // Event listener for the "Start Discussion" button
     const startDiscussion = () => {
         if (timerInterval) return; // Prevent multiple starts

         // Calculate the initial time in seconds (1 minute per player)
         // NOTE: The totalPlayers used here is the current value of playerCount from the setup screen.
         timeLeft = playerCount * 60; 
         
         const startButton = document.getElementById('startDiscussionButton');
         startButton.textContent = T('discussionTime'); // Change button text to timer running state
         startButton.disabled = true;

         // Set initial display
         document.getElementById('timerDisplay').textContent = `${T('discussionTime')} ${formatTime(timeLeft)}`;

         // Start the countdown, updating every 1000 milliseconds (1 second)
         timerInterval = setInterval(countdown, 1000); 
     };

     // --- Core Game Logic (Unchanged) ---
     
     /**
      * Selects a secret word, assigns roles, and validates the player setup.
      */
     const startGame = () => {
         const currentNames = playerNames.slice(0, playerCount).map(name => name.trim());
         if (playerCount < 3) {
             showModal('validationTitle', 'notEnoughPlayers');
             return;
         }
         const emptyNameExists = currentNames.some(name => name === '');
         if (emptyNameExists) {
             showModal('validationTitle', 'nameRequired');
             return;
         }
         playerNames = currentNames;
         const wordList = getWordList();
         if (wordList.length === 0) {
             secretWord = T('selectWord');
         } else {
             const secretIndex = Math.floor(Math.random() * wordList.length);
             secretWord = wordList[secretIndex];
             if (showHint) {
                 let hintIndex = secretIndex;
                 while (hintIndex === secretIndex) {
                     hintIndex = Math.floor(Math.random() * wordList.length);
                 }
                 imposterHintWord = wordList[hintIndex];
             } else {
                 imposterHintWord = T('justImposter');
             }
         }
         roles = [];
         const imposterIndices = [];
         while (imposterIndices.length < imposterCount) {
             const index = Math.floor(Math.random() * playerCount);
             if (!imposterIndices.includes(index)) {
                 imposterIndices.push(index);
             }
         }
         for (let i = 0; i < playerCount; i++) {
             const isImposter = imposterIndices.includes(i);
             const role = isImposter ? T('imposter') : T('civilian');
             let wordContent;
             let isHintDisplay = false;

             if (isImposter) {
                 wordContent = imposterHintWord;
                 isHintDisplay = showHint;
             } else {
                 wordContent = secretWord;
             }
             roles.push({
                 name: playerNames[i],
                 role: role,
                 word: wordContent,
                 isHint: isHintDisplay
             });
         }
         roles = roles.sort(() => Math.random() - 0.5);
         gameActive = true;
         renderPlayerTurnView();
     };


     // --- UI Rendering Functions (Unchanged) ---

     /** Renders the main setup screen. */
     const renderSetupView = () => {
         document.body.className = lang === 'ku' ? 'rtl' : 'ltr english-mode';
         shareButton.classList.remove('hidden'); // Show share button on first page

         // Reset timer state on returning to setup
         clearInterval(timerInterval);
         timerInterval = null;
         timeLeft = null;

         document.getElementById('main-title').textContent = T('appName');
         const container = document.getElementById('game-container');
         container.innerHTML = `
             <div class="text-center text-slate-300 mb-6 text-sm">
                 ${T('madeBy')}
                 <div class="mt-2 text-slate-400 flex justify-center items-center">
                     <a href="https://www.instagram.com/n4.5e7/" target="_blank" class="hover:text-primary">
                         <svg class="w-5 h-5 inline-block mx-1" fill="currentColor" viewBox="0 0 24 24">
                             <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm7.15 15.68c-.62.62-1.39 1.05-2.26 1.25-.92.21-1.87.32-2.92.32h-6c-1.05 0-2-.11-2.92-.32-.87-.2-1.64-.63-2.26-1.25-.62-.62-1.05-1.39-1.25-2.26-.21-.92-.32-1.87-.32-2.92v-6c0-1.05.11-2 .32-2.92.2-.87.63-1.64 1.25-2.26.62-.62 1.39-1.05 2.26-1.25.92-.21 1.87-.32 2.92-.32h6c1.05 0 2 .11 2.92.32.87.2 1.64.63 2.26 1.25.62.62 1.39 1.05 2.26 1.25.92.21.32 2.92v6c0 1.05-.11 2-.32 2.92-.2.87-.63 1.64-1.25 2.26zM12 7c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5zm0 8c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm4.5-5c.83 0 1.5-.67 1.5-1.5s-.67-1.5-1.5-1.5-1.5.67-1.5 1.5.67 1.5 1.5 1.5z"/>
                         </svg>
                         n4.5e7
                     </a>
                 </div>
             </div>
             <h1 class="text-3xl font-bold text-center text-primary mb-4">${T('appName')} (Imposter)</h1>
             <div class="title-bar"></div>

             <button class="lang-btn" onclick="toggleLanguage()">
                 ${lang === 'ku' ? 'English / کوردی' : 'English / Kurdish'}
             </button>

             <div class="flex items-center justify-between mb-3 text-slate-200">
                 <label for="player-count" class="text-sm">${T('playerCount')}</label>
                 <input type="number" id="player-count" value="${playerCount}" min="3" max="12" class="w-1/3 text-center" onchange="handlePlayerCountChange(event)">
             </div>

             <div class="flex items-center justify-between mb-3 text-slate-200">
                 <label for="imposter-count" class="text-sm">${T('imposterCount')}</label>
                 <input type="number" id="imposter-count" value="${imposterCount}" min="1" max="2" class="w-1/3 text-center" onchange="handleImposterCountChange(event)">
             </div>

             <div class="checkbox-container">
                 <label class="flex items-center text-slate-200 text-sm cursor-pointer ${lang === 'ku' ? 'flex-row-reverse justify-end' : 'flex-row'}">
                     <span class="${lang === 'ku' ? 'mr-3' : 'ml-3'}">${T('hint')}</span>
                     <input type="checkbox" id="hint-checkbox" ${showHint ? 'checked' : ''} onchange="handleHintChange(event)">
                     <span class="checkbox-checkmark ${lang === 'ku' ? 'ml-3' : 'mr-3'}"></span>
                 </label>
             </div>
           

             <div class="text-slate-200 text-base mb-2">${T('playerName')}</div>
             <div id="player-names-inputs">
                 ${Array.from({ length: playerCount }, (_, i) => `
                     <input type="text" placeholder="${T('playerName')} ${i + 1}" class="input-text-area" id="player-input-${i}" oninput="handleNameInput(event, ${i})" value="${playerNames[i] || ''}">
                 `).join('')}
             </div>

             <button class="primary-btn mt-6" onclick="startGame()">
                 ${T('start')}
             </button>
         `;
         playerNames.forEach((name, i) => {
             const input = document.getElementById(`player-input-${i}`);
             if (input) input.value = name;
         });
     };

     /** Renders the screen where each player views their role. */
     const renderPlayerTurnView = (playerIndex = 0) => {
         shareButton.classList.add('hidden'); // Hide share button on turn screen
         const container = document.getElementById('game-container');
         const player = roles[playerIndex];

         if (!player) {
             gameActive = false;
             renderSetupView();
             return;
         }

         container.innerHTML = `
             <h1 class="text-2xl font-bold text-center text-primary mb-4">${T('turn')}</h1>
             <p class="text-lg text-slate-300 text-center mb-6">${player.name}</p>
             <div class="title-bar"></div>
           
             <div id="role-display-area" class="text-center mt-8">
                 <button class="primary-btn" onclick="showRole(${playerIndex})">
                     ${T('showRole')}
                 </button>
             </div>

             <div class="footer-text mt-8">
                 <button class="text-secondary hover:underline" onclick="resetGame()">
                     ${T('reset')}
                 </button>
             </div>
         `;
     };

     /** Renders the player's specific role card in a modal-like structure. */
     const showRole = (playerIndex) => {
         const player = roles[playerIndex];
         const isImposter = player.role === T('imposter');
       
         const wordColorClass = isImposter ? 'word-imposter' : 'word-civilian';
         const rolePrefix = player.role + ":";
         
         let hintLabel = '';
         if (player.isHint) {
             hintLabel = `<p class="text-lg text-slate-400 mb-2">${T('imposterHintLabel')}</p>`;
         }
         
         const content = document.getElementById('role-display-area');
         content.innerHTML = `
             <div class="player-card">
                 <p class="text-xl text-slate-300 mb-4 font-bold">${rolePrefix}</p>
               
                 ${hintLabel}

                 <p class="text-3xl font-extrabold ${wordColorClass} text-center">${player.word}</p>
             </div>
           
             <div class="mt-8">
                 <button class="primary-btn" onclick="hideRole(${playerIndex})">
                     ${T('close')}
                 </button>
             </div>
         `;
     };

     /** Hides the role card and moves to the next player's turn or the end screen. */
     const hideRole = (playerIndex) => {
         const nextIndex = playerIndex + 1;
         if (nextIndex < roles.length) {
             renderPlayerTurnView(nextIndex);
         } else {
             renderEndGameView();
         }
     };

     /** Reveals the imposter names on the end game screen. */
     const revealImposters = (auto = false) => {
         const imposterNames = roles
             .filter(r => r.role === T('imposter'))
             .map(r => r.name);
       
         const imposterRevealDiv = document.getElementById('imposter-reveal');
         const imposterList = imposterNames.map(name =>
             `<span class="text-2xl font-bold text-red-400 mx-2">${name}</span>`
         ).join(' ');

         imposterRevealDiv.innerHTML = `
             <p class="text-lg text-slate-300 mb-2">${T('impostersWere')}</p>
             <div class="flex flex-wrap justify-center">${imposterList}</div>
         `;
         imposterRevealDiv.classList.remove('hidden');
       
         // Hide the button if not called automatically from the timer
         if(!auto) {
            document.getElementById('reveal-imposters-btn').style.display = 'none';
         }
     };


     /** Reveals the secret word on the end game screen. */
     const revealWord = () => {
         document.getElementById('secret-word-reveal').classList.remove('hidden');
         // Hide the reveal word button
         const button = document.getElementById('reveal-word-btn');
         if(button) button.style.display = 'none';
     };

     /** Renders the final screen after all players have viewed their roles. */
     const renderEndGameView = () => {
         shareButton.classList.add('hidden'); // Ensure share button is hidden on final page
         const container = document.getElementById('game-container');
         
         // Initial time calculation for display
         const initialTime = playerCount * 60;
         const initialTimeFormatted = formatTime(initialTime);

         container.innerHTML = `
             <h1 class="text-3xl font-bold text-center text-primary mb-4">${T('appName')}</h1>
             <h2 id="timerDisplay" class="text-2xl text-slate-200 text-center mb-6">${T('discussionTime')} ${initialTimeFormatted}</h2>
             <div class="title-bar mb-6"></div>

             <button id="startDiscussionButton" class="primary-btn mb-6 bg-secondary hover:bg-indigo-600" onclick="startDiscussion()" style="background: linear-gradient(145deg, #6366f1, #4f46e5); color: white;">
                 ${T('startDiscussion')}
             </button>

             <button id="reveal-imposters-btn" class="primary-btn mb-4" onclick="revealImposters()" style="background: linear-gradient(145deg, #f87171, #ef4444); color: white;">
                 ${T('revealImposters')}
             </button>

             <div id="imposter-reveal" class="text-center mt-6 hidden mb-6">
                 </div>

             <button id="reveal-word-btn" class="primary-btn mb-4" onclick="revealWord()">
                 ${T('revealWord')}
             </button>

             <div id="secret-word-reveal" class="text-center mt-6 hidden">
                 <p class="text-lg text-slate-300 mb-2">${T('wordWas')}</p>
                 <p class="text-2xl font-bold text-primary">${secretWord}</p>
             </div>

             <div class="mt-8">
                 <button class="primary-btn bg-secondary hover:bg-indigo-600" onclick="resetGame()" style="background: linear-gradient(145deg, #facc15, #eab308); color: #1e293b;">
                     ${T('reset')}
                 </button>
             </div>
           
             <div class="footer-text mt-8">
                 ${T('madeBy')}
                 <a href="https://www.instagram.com/n4.5e7/" target="_blank" class="hover:text-primary">@n4.5e7</a>
             </div>
         `;
     };
   
   
     // --- Event Handlers (Unchanged) ---
     
     const handlePlayerCountChange = (event) => {
         let count = parseInt(event.target.value);
         if (isNaN(count) || count < 3) count = 3;
         if (count > 12) count = 12;
         playerCount = count;
         if (imposterCount >= count) {
             imposterCount = count > 1 ? 1 : 1;
         }
         if (playerNames.length > playerCount) {
             playerNames = playerNames.slice(0, playerCount);
         } else if (playerNames.length < playerCount) {
             for (let i = playerNames.length; i < playerCount; i++) {
                 playerNames.push('');
             }
         }
         renderSetupView();
     };

     const handleImposterCountChange = (event) => {
         let count = parseInt(event.target.value);
         if (isNaN(count) || count < 1) count = 1;
         if (count > 2 || count >= playerCount) count = Math.min(2, playerCount - 1);
         imposterCount = count;
         renderSetupView();
     };

     const handleHintChange = (event) => {
         showHint = event.target.checked;
     };

     const handleNameInput = (event, index) => {
         playerNames[index] = event.target.value.trim();
     };

     const toggleLanguage = () => {
         lang = lang === 'ku' ? 'en' : 'ku';
         renderSetupView();
     };

     const resetGame = () => {
         gameActive = false;
         roles = [];
         secretWord = '';
         imposterHintWord = '';
         clearInterval(timerInterval); // Stop any running timer
         timerInterval = null;
         timeLeft = null;
         renderSetupView();
     };

     // --- Initialization ---
     window.onload = () => {
          if (playerNames.length === 0) {
              for (let i = 0; i < playerCount; i++) {
                 playerNames.push('');
             }
         }
         renderSetupView();
     };

 </script>
</body>
</html>
